## 用語メモ
- ポート: 1〜65535の番号で、同じIP上のアプリを識別する窓口。IRCは通常6667などを使う。

- ソケット: プロセス間通信のエンドポイント。`socket()`で作るFD（ファイルディスクリプタ）。

- リッスンFD: 接続を待ち受けるためのソケットFD。`accept()`で新規クライアントFDを得る。

- クライアントFD: `accept()`で生成される、クライアント1人分の通信路となるFD。

- IPv4/TCP: IPv4はIPのバージョン、TCPは信頼性のある接続型プロトコル。`AF_INET`/`SOCK_STREAM`の組み合わせで指定。

- ノンブロッキング: I/O呼び出しが待たずに即戻る設定。`fcntl(O_NONBLOCK)`で有効化する。

- poll: 複数FDに対して「読み込み/書き込み可能などのイベントが来たか」をまとめて待つシステムコール。


### ポートについて
ポートはサーバーが「ここで待ち受けていますよ」と番号で示す入り口のことです。IPアドレスが建物なら、ポート番号はその建物の部屋番号に近いイメージで、クライアントはその番号に向けて接続してきます。人同士の会話の場所というより、プロセス同士が通信するための番号付きドアです。

### initSocket の各ステップ（例え付き）
- `socket(AF_INET, SOCK_STREAM, 0)`  
  電話機本体を用意する。これがないと通話自体が始まらない（FDが取れず以降の操作不可）。
- `setsockopt(... SO_REUSEADDR ...)`  
  前に使っていた部屋が掃除中（TIME_WAIT）でも同じ鍵で開けられるよう大家に許可をもらう。ないと再起動時に「まだ片付け中」でポート取得に失敗することがある。
- `fcntl(... O_NONBLOCK)`  
  受付に「混んでいたらすぐ戻ってきて」とお願いする設定。ないと客が来るまで受付がブロックされ、他の仕事（他FD処理）ができなくなる。
- `memset` + `sin_family/sin_addr/sin_port`  
  住所カードに国（IPv4）、建物の「どの入口でもOK」（INADDR_ANY）、部屋番号（ポート）を書く。正しく書かないと郵便（接続要求）が届かない。未初期化だとゴミ住所。
- `bind(...)`  
  その部屋に実際に入居する手続き。ないと部屋番号を名乗っても実際には入居しておらず、誰も訪ねてこないし競合も検知できない。
- `listen(...)`  
  受付カウンターを開け、待合席の定員（キュー長）を設定する。ないと訪問者が来ても受付が開いておらず対応できない。
- リッスンFDを `poll` 用のリストに登録  
  受付ベルを監視リストに載せる。載せないと誰かがチャイムを鳴らしても気づけず、新しい訪問者を受け入れられない。


# ノンブロッキングソケット（小学生向けのたとえ）

- 普通のソケット（ブロッキング）は「データが来るまでじっと待つ電話」。相手がしゃべるまで動かない。
- ノンブロッキングは「待てなかったらすぐ切って、またあとでかけ直す電話」。データがまだなら「今はないよ（EAGAIN）」とすぐ帰ってくる。
- たくさんの相手と話すときは「誰かから話しかけられたら教えてね（poll/select で監視）」とベルを鳴らしてもらい、ベルが鳴った相手だけに「いま話せる？」と聞きに行く。
- 送るときも一気にしゃべれないことがあるので、「続きはあとで言うね」とメモ帳（送信キュー）に残して、次にしゃべれるタイミングで再開する。
